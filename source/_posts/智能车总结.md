---
title: 智能车总结
copyright: true
tags:
  - 智能车比赛
  - NXP
categories:
  - NXP智能车比赛
abbrlink: d719
date: 2019-07-30 19:22:50
---

{% note %}
14届智能车省赛已经结束了，最后的成绩是信标组第七名，获得省级一等奖。虽然没有获得晋级国赛的机会，但我们组每个人对于这个成绩都已经很满意了。毕竟是一个月前刚开始做，而且算是安大第一次做（虽然之前有过一次，但什么都没留下）。留下了一份可以传递下去的信标组方案，我们的任务也算是完成了。最后在写下这份总结报告，一方面是对今年的总结，另一方面是对后来人提供一些经验，算是抛砖引玉的作用吧。
{% endnote %}

<!--more-->

## 软件

我在组里的工作是软件部分，对于我的工作我自认为做的还不错，但在之前调试四轮的时候还是走了很多弯路，既然是最终总结，我觉得之前的经验还是要说一下。

因为学校前人的代码都是用的LPLD的底层库，在使用K60的时候已经算是够用了，但要做到与时俱进的话，建议去尝试一下新的东西。在所有智能车比赛的队伍里我估计有一大半使用的都是山外的K60底层库搭配144脚K60。而我们还在使用100引脚的k60。其实这点我之前已经吐槽过了，但我觉得不会有人会做这种吃力不一定讨好的工作，包括我们组也是这样。

我建议三人小组中有两人做代码工作，一人做硬件工作。两人软件前期可以分工进行，一人负责分配引脚及各项初始化的编写，另一人研究算法。这里我们组之前没有那么明确的分工，虽然我是在寒假期间就把引脚部分配好了，但初始化程序的编写却没跟上进度，而在开始做新标一切重新开始的时候，情况就不一样了。我分析原因应该是由于之前没有接触过K60的编程，甚至拿到一份程序不知道从何看起。而在做新标的时候，已经知道有了K60编程基础，拿到例程也知道怎么去看，甚至是必须要用K66，使用另一个底层库，也知道从哪里下手。

![主函数](https://i.loli.net/2019/07/30/5d403e5e1f79b81163.png)

拿到一份程序，就算是学长留下的代码，第一件事就是去找主函数。从第一句话向下看。一般第一两句话就是初始化程序。跳进初始化函数，一条一条地看。这样研究完一份初始化程序，大概也就明白了引脚的分配和控制方案。

![初始化函数](https://i.loli.net/2019/07/30/5d40400e444ec95999.png)

然后去研究后面的东西，一般看一下函数名就知道这个函数是干什么用的。最后不要忘记还有中断处理函数。如果是直接使用前人的程序的话，初始化部分直接复制粘贴，最后更改一些引脚就完成了。如果是使用例程，只需要找到一个个相应的例程，将初始化部分复制过来，更改引脚也就结束了。前期引脚分配一定要快和准，因为硬件也只有引脚分配结束才能开始工作。

算法部分也是要花时间研究的，因为不只有PID需要调试，算法本身就有许多参数在不同环境下需要不同的值。就拿信标来说，用摄像头判断车距离信标的远近是通过统计一幅图像的白点数目来体现的，白点数目越多，车离信标灯就越近。之前在理工楼由于环境光线弱，这里算法的参数给的比较大，而比赛场地的环境光线很强，这些参数就要减小，这也是在第一次对抗的时候刚意识到，好在临时写的几个参数还能用。

![total_count](https://i.loli.net/2019/07/30/5d4040647012495642.png)

信标组今年之后也算是有了一份祖传代码。对于这套代码我不可能每个细节都说一遍，但是有了这套代码，一定要快速知道怎么使用，而不是纠结于如何看懂。我的经验就是用上面的步骤，先找主函数，再看初始化，然后看中断，最后研究算法。相比较而言有些地方还需要改进，改进后还需要测试，由于今年时间有限，最终没有测试出阳光处理的效果，而在比赛过程中也学到了其他学校的一些好的方案。

## 硬件

通过比赛这几天我收获最多的不是关于软件的部分，因为比赛不可能还允许我们相互观摩对方的程序。但是通过观察他们的车模，发现大部分使用了两部摄像头，有些是直角放置有些是180度放置，相对而言我们一个摄像头在寻灯方面处于劣势。

### openmv

最让我印象深刻的是安徽财经大学使用的openmv摄像头，因为这个摄像头也是今年第一次允许使用的东西，而且只有他们这一组使用，从结果看出效果非常好，阳光对他们也没有影响。他们有勇气做第一个吃螃蟹的人，不仅要承认他们的能力，也要承认他们的勇气。

后来我也查了一下这个[openmv](https://singtown.com/openmv/)。被称为具有机器视觉功能的arduino。用过arduino的人都知道，这个东西好用，好用是由于有很多很多的库可以直接使用，不需要再花时间去写一大串代码操作一个个寄存器。在51单片机中要一个引脚输出PWM波要写一连串代码，还不一定准确，在arduino里可能只是一句话的事。其实和我们使用K60底层库一样，为什么要使用库，还不是因为不需要再研究底层寄存器的操作过程了吗。

这是openmv的相关参数

![openmv参数](https://i.loli.net/2019/07/30/5d404518ebf2c94997.png)

发现，这根本就是一个处理器，但今年官方允许使用。处理速度比K60还快，内置python解释器，也就是说用python编程。比赛结束我就打算弄一块来玩一下了，说不定大创也要用到它。

官网的视频有这么一段.......

![调阈值](https://i.loli.net/2019/07/30/5d404a523fcfa28904.gif)

怪不得他们那组5分钟调试时间全用在调试摄像头上。我觉得不仅是信标，估计四轮他们使用这个摄像头，也能处理下阳光问题。

### 立创EDA

虽然我是负责软件部分，但因为电子工艺实训还是需要会画电路板，ad这个东西还是要学学的。但是我发现ad这个入门太难了。机缘巧合下，我找到这款[立创eda](https://lceda.cn/)，[官方教程](https://pan.baidu.com/s/1grMVIC3ONQCEK-DIt3TXKg#list/path=%2)只有两个多小时。虽然功能不如ad强大，但麻雀虽小五脏俱全。关键是入门简单，而且智能车比赛完全够用。之前有很多组校赛都没参加，就是因为硬件做不出来。对于初学者，我建议还是使用这个软件。至少先快速搭车，后面可以慢慢再研究AD，而且学会了这个，也能帮助下理解AD的很多功能，下面展示下我用立创eda制作的pcb：

| ![](https://i.loli.net/2019/07/30/5d40565fd314346525.png) | ![](https://i.loli.net/2019/07/30/5d40566845d2e58602.png) |
| --------------------------------------------------------- | --------------------------------------------------------- |
| ![](https://i.loli.net/2019/07/30/5d40566e246f615773.png) | ![](https://i.loli.net/2019/07/30/5d40567192ae870190.png) |

反正这个软件是多么简单，谁用谁知道！